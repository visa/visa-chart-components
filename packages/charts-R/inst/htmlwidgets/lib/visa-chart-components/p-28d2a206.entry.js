/**
 * Copyright (c) 2022 Visa, Inc.
 *
 * This source code is licensed under the MIT license
 * https://github.com/visa/visa-chart-components/blob/master/LICENSE
 *
 **/
import{r as t,c as i,h as s,g as h}from"./p-3cef5c65.js";import{b as e}from"./p-fe791338.js";import{n as a,l as r}from"./p-0f220459.js";import{m as o}from"./p-cbe185fc.js";import{m as c}from"./p-b0dcbe24.js";import{b as l}from"./p-eb1a86e9.js";import{v as n}from"./p-d73b0e5e.js";import{v as d,s as u,e as b}from"./p-55ad5bb3.js";import{c as p}from"./p-209ccfff.js";import"./p-1e7506b0.js";import"./p-f6a1e837.js";import"./p-4d338ee8.js";const{propDefaultValues:v}=d;class g{}g.mainTitle="Stacked Bar Chart Title",g.subTitle="This is the stacked bar chart's subtitle",g.height=280,g.width=700,g.margin={top:4,bottom:4,right:4,left:4},g.padding={top:20,bottom:50,right:50,left:50},g.normalized=!1,g.showTotalValue=!0,g.showZeroLabels=!1,g.ordinalAccessor="label",g.valueAccessor="value",g.groupAccessor="item",g.layout=v.layout,g.accessibility=v.accessibility,g.animationConfig=v.animationConfig,g.highestHeadingLevel=v.highestHeadingLevel,g.sortOrder=v.sortOrder,g.xAxis=v.xAxis,g.yAxis=v.yAxis,g.wrapLabel=v.wrapLabel,g.colorPalette=v.colorPaletteCategorical,g.hoverStyle=v.hoverStyle,g.clickStyle=v.clickStyle,g.referenceStyle=v.referenceStyle,g.cursor=v.cursor,g.roundedCorner=v.roundedCorner,g.barIntervalRatio=v.barIntervalRatio,g.hoverOpacity=v.hoverOpacity,g.dataLabel=v.dataLabelMiddle,g.legend=v.categoryLegend,g.tooltipLabel=v.tooltipLabel,g.showTooltip=v.showTooltip,g.suppressEvents=v.suppressEvents,g.referenceLines=v.referenceLines,g.annotations=v.annotations,g.clickHighlight=v.clickHighlight;const{getBrowser:m,verifyTextHasSpace:y,checkAttributeTransitions:f,createTextStrokeFilter:k,drawHoverStrokes:x,removeHoverStrokes:w,buildStrokes:A,convertColorsToTextures:W,findTagLevel:L,prepareRenderChange:S,initializeDescriptionRoot:T,initializeElementAccess:D,setElementFocusHandler:z,setElementAccessID:C,setAccessibilityController:I,hideNonessentialGroups:O,setAccessTitle:E,setAccessSubtitle:P,setAccessLongDescription:N,setAccessExecutiveSummary:j,setAccessPurpose:K,setAccessContext:H,setAccessStatistics:G,setAccessChartCounts:$,setAccessXAxis:V,setAccessYAxis:M,setAccessStructure:q,setAccessAnnotation:R,retainAccessFocus:B,checkAccessFocus:F,setElementInteractionAccessState:_,setAccessibilityDescriptionWidth:X,autoTextColor:Y,annotate:Z,chartAccessors:U,checkInteraction:J,checkClicked:Q,checkHovered:tt,convertVisaColor:it,drawAxis:st,drawGrid:ht,drawLegend:et,setLegendInteractionState:at,drawTooltip:rt,formatStats:ot,formatDate:ct,formatDataLabel:lt,getPadding:nt,getColors:dt,getLicenses:ut,getScopedData:bt,initTooltipStyle:pt,overrideTitleTooltip:vt,placeDataLabels:gt,transitionEndAll:mt,scopeDataKeys:yt,visaColors:ft,validateAccessibilityProps:kt,roundTo:xt,resolveLabelCollision:wt}=d,At=class{constructor(s){t(this,s),this.clickEvent=i(this,"clickEvent",7),this.hoverEvent=i(this,"hoverEvent",7),this.mouseOutEvent=i(this,"mouseOutEvent",7),this.initialLoadEvent=i(this,"initialLoadEvent",7),this.initialLoadEndEvent=i(this,"initialLoadEndEvent",7),this.drawStartEvent=i(this,"drawStartEvent",7),this.drawEndEvent=i(this,"drawEndEvent",7),this.transitionEndEvent=i(this,"transitionEndEvent",7),this.mainTitle=g.mainTitle,this.subTitle=g.subTitle,this.height=g.height,this.width=g.width,this.layout=g.layout,this.highestHeadingLevel=g.highestHeadingLevel,this.margin=g.margin,this.padding=g.padding,this.ordinalAccessor=g.ordinalAccessor,this.valueAccessor=g.valueAccessor,this.groupAccessor=g.groupAccessor,this.sortOrder=g.sortOrder,this.xAxis=g.xAxis,this.yAxis=g.yAxis,this.wrapLabel=g.wrapLabel,this.normalized=g.normalized,this.colorPalette=g.colorPalette,this.hoverStyle=g.hoverStyle,this.clickStyle=g.clickStyle,this.referenceStyle=g.referenceStyle,this.cursor=g.cursor,this.roundedCorner=g.roundedCorner,this.barIntervalRatio=g.barIntervalRatio,this.hoverOpacity=g.hoverOpacity,this.animationConfig=g.animationConfig,this.dataLabel=g.dataLabel,this.showTotalValue=g.showTotalValue,this.showTooltip=g.showTooltip,this.tooltipLabel=g.tooltipLabel,this.accessibility=g.accessibility,this.legend=g.legend,this.annotations=g.annotations,this.showZeroLabels=g.showZeroLabels,this.referenceLines=g.referenceLines,this.suppressEvents=g.suppressEvents,this.clickHighlight=g.clickHighlight,this.unitTest=!1,this.shouldValidateAccessibility=!0,this.series=[],this.extent=[],this.datakeys=[],this.updated=!0,this.shouldValidateInteractionKeys=!1,this.shouldValidate=!1,this.shouldUpdateData=!1,this.shouldSetDimensions=!1,this.shouldUpdateTableData=!1,this.shouldSetColors=!1,this.shouldValidateAxes=!1,this.shouldValidateClickHighlight=!1,this.shouldUpdateScales=!1,this.shouldUpdateAnnotations=!1,this.shouldResetRoot=!1,this.shouldEnterUpdateExit=!1,this.shouldSetGlobalSelections=!1,this.shouldSetTestingAttributes=!1,this.shouldUpdateGeometries=!1,this.shouldCheckValueAxis=!1,this.shouldCheckLabelAxis=!1,this.shouldUpdateXAxis=!1,this.shouldUpdateYAxis=!1,this.shouldUpdateXGrid=!1,this.shouldUpdateYGrid=!1,this.shouldUpdateBaseline=!1,this.shouldSetSelectionClass=!1,this.shouldUpdateCursor=!1,this.shouldUpdateCorners=!1,this.shouldUpdateLegendData=!1,this.shouldValidateLabelPlacement=!1,this.shouldValidateDataLabelAccessor=!1,this.shouldUpdateLegend=!1,this.shouldUpdateLegendInteractivity=!1,this.shouldUpdateReferenceLines=!1,this.shouldDrawInteractionState=!1,this.shouldBindInteractivity=!1,this.shouldSetLabelOpacity=!1,this.shouldUpdateLabels=!1,this.shouldUpdateTotalLabels=!1,this.shouldCheckLabelColor=!1,this.shouldUpdateDescriptionWrapper=!1,this.shouldSetChartAccessibilityTitle=!1,this.shouldSetChartAccessibilitySubtitle=!1,this.shouldSetChartAccessibilityLongDescription=!1,this.shouldSetChartAccessibilityExecutiveSummary=!1,this.shouldSetChartAccessibilityStatisticalNotes=!1,this.shouldSetChartAccessibilityStructureNotes=!1,this.shouldSetParentSVGAccessibility=!1,this.shouldSetGeometryAccessibilityAttributes=!1,this.shouldSetGeometryAriaLabels=!1,this.shouldSetGroupAccessibilityLabel=!1,this.shouldSetChartAccessibilityPurpose=!1,this.shouldSetChartAccessibilityContext=!1,this.shouldRedrawWrapper=!1,this.shouldSetTagLevels=!1,this.shouldSetChartAccessibilityCount=!1,this.shouldSetYAxisAccessibility=!1,this.shouldSetXAxisAccessibility=!1,this.shouldSetAnnotationAccessibility=!1,this.shouldSetTextures=!1,this.shouldSetStrokes=!1,this.isSafari="Safari"===m(),this.strokes={},this.textStrokes={},this.topLevel="h2",this.bottomLevel="p",this.textTreatmentHandler=(t,i,s)=>{const h=u(s[i]),e=this.clickHighlight&&this.clickHighlight.length>0&&Q(t,this.clickHighlight,this.innerInteractionKeys)&&this.clickStyle.color?ft[this.clickStyle.color]||this.clickStyle.color:this.hoverHighlight&&tt(t,this.hoverHighlight,this.innerInteractionKeys)&&this.hoverStyle.color?ft[this.hoverStyle.color]||this.hoverStyle.color:this.preparedColors[i],a=Y(e);if(h.classed("textIsMoving"))h.attr("filter",null);else{const t=this.textStrokes[e];t!==h.attr("filter")&&(this.isSafari?(h.attr("filter",null),setTimeout((()=>{h.attr("filter",t)}),0)):h.attr("filter",t))}return a}}dataWatcher(t,i){this.updated=!0,this.shouldUpdateData=!0,this.shouldValidateClickHighlight=!0,this.shouldSetColors=!0,this.shouldSetTextures=!0,this.shouldDrawInteractionState=!0,this.shouldUpdateScales=!0,this.shouldUpdateTableData=!0,this.shouldSetGlobalSelections=!0,this.shouldSetTestingAttributes=!0,this.shouldEnterUpdateExit=!0,this.shouldSetGeometryAccessibilityAttributes=!0,this.shouldSetGeometryAriaLabels=!0,this.shouldUpdateXGrid=!0,this.shouldUpdateYGrid=!0,this.shouldUpdateLegendData=!0,this.shouldValidate=!0,this.shouldUpdateGeometries=!0,this.shouldUpdateXAxis=!0,this.shouldSetXAxisAccessibility=!0,this.shouldUpdateYAxis=!0,this.shouldSetYAxisAccessibility=!0,this.shouldUpdateLabels=!0,this.shouldCheckLabelColor=!0,this.shouldSetLabelOpacity=!0,this.shouldUpdateTotalLabels=!0,this.shouldUpdateLegend=!0,this.shouldUpdateReferenceLines=!0,this.shouldUpdateBaseline=!0,this.shouldUpdateAnnotations=!0,this.shouldSetStrokes=!0}idWatcher(t,i){console.error("Change detected in prop uniqueID from value "+i+" to value "+t+". This prop cannot be changed after component has loaded.")}headingWatcher(t,i){this.shouldRedrawWrapper=!0,this.shouldSetTagLevels=!0,this.shouldSetChartAccessibilityCount=!0,this.shouldSetYAxisAccessibility=!0,this.shouldSetXAxisAccessibility=!0,this.shouldUpdateDescriptionWrapper=!0,this.shouldSetAnnotationAccessibility=!0,this.shouldSetChartAccessibilityTitle=!0,this.shouldSetChartAccessibilitySubtitle=!0,this.shouldSetChartAccessibilityLongDescription=!0,this.shouldSetChartAccessibilityContext=!0,this.shouldSetChartAccessibilityExecutiveSummary=!0,this.shouldSetChartAccessibilityPurpose=!0,this.shouldSetChartAccessibilityStatisticalNotes=!0,this.shouldSetChartAccessibilityStructureNotes=!0}titleWatcher(t,i){this.shouldValidate=!0,this.shouldUpdateDescriptionWrapper=!0,this.shouldSetChartAccessibilityTitle=!0,this.shouldSetParentSVGAccessibility=!0}subtitleWatcher(t,i){this.shouldSetChartAccessibilitySubtitle=!0,this.shouldSetParentSVGAccessibility=!0}dimensionWatcher(t,i){this.shouldSetDimensions=!0,this.shouldUpdateScales=!0,this.shouldResetRoot=!0,this.shouldUpdateGeometries=!0,this.shouldUpdateXGrid=!0,this.shouldUpdateYGrid=!0,this.shouldUpdateXAxis=!0,this.shouldUpdateYAxis=!0,this.shouldUpdateLabels=!0,this.shouldUpdateTotalLabels=!0,this.shouldUpdateLegend=!0,this.shouldUpdateReferenceLines=!0,this.shouldUpdateBaseline=!0,this.shouldUpdateAnnotations=!0,this.shouldSetLabelOpacity=!0}layoutWatcher(t,i){this.interpolating=!1,this.shouldValidateLabelPlacement=!0,this.shouldUpdateScales=!0,this.shouldValidateAxes=!0,this.shouldResetRoot=!0,this.shouldUpdateGeometries=!0,this.shouldUpdateXGrid=!0,this.shouldUpdateYGrid=!0,this.shouldUpdateXAxis=!0,this.shouldUpdateYAxis=!0,this.shouldUpdateLabels=!0,this.shouldUpdateTotalLabels=!0,this.shouldUpdateLegend=!0,this.shouldUpdateReferenceLines=!0,this.shouldUpdateBaseline=!0,this.shouldUpdateAnnotations=!0,this.shouldSetGeometryAccessibilityAttributes=!0,this.shouldSetLabelOpacity=!0}ordinalAccessorWatcher(t,i){this.shouldSetGlobalSelections=!0,this.shouldEnterUpdateExit=!0,this.shouldUpdateScales=!0,this.shouldUpdateData=!0,this.shouldUpdateTableData=!0,this.shouldUpdateLegendData=!0,this.shouldSetColors=!0,this.shouldUpdateGeometries=!0,this.shouldDrawInteractionState=!0,this.shouldCheckLabelColor=!0,this.shouldUpdateLabels=!0,this.shouldUpdateTotalLabels=!0,this.shouldUpdateLegend=!0,this.interactionKeys&&this.interactionKeys.length||(this.shouldValidateInteractionKeys=!0,this.shouldSetSelectionClass=!0),this.shouldUpdateReferenceLines=!0,this.shouldUpdateAnnotations=!0,this.shouldSetGeometryAriaLabels=!0,this.shouldSetLabelOpacity=!0,this.shouldSetStrokes=!0,this.shouldSetTextures=!0,this.shouldCheckValueAxis=!0}valueAccessorWatcher(t,i){this.shouldUpdateData=!0,this.shouldValidateClickHighlight=!0,this.shouldUpdateScales=!0,this.shouldSetColors=!0,this.shouldUpdateGeometries=!0,this.shouldDrawInteractionState=!0,this.shouldCheckLabelColor=!0,this.shouldSetLabelOpacity=!0,this.shouldValidateDataLabelAccessor=!0,this.shouldUpdateLabels=!0,this.shouldUpdateTotalLabels=!0,this.shouldUpdateTableData=!0,this.shouldUpdateReferenceLines=!0,this.shouldUpdateAnnotations=!0,this.shouldSetGeometryAriaLabels=!0,this.shouldSetStrokes=!0,this.shouldSetTextures=!0,this.shouldSetGlobalSelections=!0,this.shouldCheckValueAxis=!0}groupAccessorWatcher(t,i){this.shouldUpdateData=!0,this.shouldValidateClickHighlight=!0,this.shouldUpdateTableData=!0,this.shouldUpdateScales=!0,this.shouldSetGlobalSelections=!0,this.shouldEnterUpdateExit=!0,this.shouldDrawInteractionState=!0,this.shouldCheckLabelColor=!0,this.shouldSetLabelOpacity=!0,this.shouldUpdateGeometries=!0,this.shouldUpdateLabels=!0,this.shouldUpdateTotalLabels=!0,this.shouldCheckLabelAxis=!0,this.shouldUpdateBaseline=!0,this.shouldUpdateReferenceLines=!0,this.interactionKeys&&this.interactionKeys.length||(this.shouldValidateInteractionKeys=!0,this.shouldSetSelectionClass=!0),this.shouldUpdateAnnotations=!0,this.shouldSetGeometryAriaLabels=!0,this.shouldSetGroupAccessibilityLabel=!0,this.shouldSetStrokes=!0,this.shouldSetTextures=!0}sortWatcher(t,i){this.updated=!0,this.shouldUpdateData=!0,this.shouldSetGlobalSelections=!0,this.shouldSetTestingAttributes=!0,this.shouldEnterUpdateExit=!0,this.shouldUpdateTableData=!0,this.shouldUpdateScales=!0,this.shouldUpdateGeometries=!0,this.shouldUpdateLabels=!0,this.shouldUpdateTotalLabels=!0,this.shouldUpdateAnnotations=!0,this.shouldSetGeometryAccessibilityAttributes=!0,this.shouldSetGeometryAriaLabels=!0,this.shouldCheckLabelAxis=!0}xAxisWatcher(t,i){this.shouldValidateAxes=!0,this.shouldSetXAxisAccessibility=!0,this.shouldUpdateXAxis=!0,(t&&t.gridVisible)===(i&&i.gridVisible)&&(t&&t.tickInterval?t.tickInterval:0)===(i&&i.tickInterval?i.tickInterval:0)||(this.shouldUpdateXGrid=!0)}yAxisWatcher(t,i){this.shouldValidateAxes=!0,this.shouldSetYAxisAccessibility=!0,this.shouldUpdateYAxis=!0,(t&&t.gridVisible)===(i&&i.gridVisible)&&(t&&t.tickInterval?t.tickInterval:0)===(i&&i.tickInterval?i.tickInterval:0)||(this.shouldUpdateYGrid=!0)}wrapLabelWatcher(t,i){this.shouldCheckLabelAxis=!0}normalizedWatcher(t,i){this.shouldUpdateData=!0,this.shouldValidateClickHighlight=!0,this.shouldUpdateScales=!0,this.shouldSetColors=!0,this.shouldUpdateGeometries=!0,this.shouldDrawInteractionState=!0,this.shouldCheckLabelColor=!0,this.shouldSetLabelOpacity=!0,this.shouldCheckValueAxis=!0,this.shouldUpdateLabels=!0,this.shouldUpdateTotalLabels=!0,this.shouldUpdateTableData=!0,this.shouldUpdateReferenceLines=!0,this.shouldUpdateAnnotations=!0,this.shouldSetGeometryAriaLabels=!0,this.shouldSetGroupAccessibilityLabel=!0}paletteWatcher(t,i){this.shouldSetColors=!0,this.shouldDrawInteractionState=!0,this.shouldUpdateLegend=!0,this.shouldCheckLabelColor=!0,this.shouldSetStrokes=!0,this.shouldSetTextures=!0}colorsWatcher(t,i){this.shouldSetColors=!0,this.shouldDrawInteractionState=!0,this.shouldUpdateLegend=!0,this.shouldCheckLabelColor=!0,this.shouldSetStrokes=!0,this.shouldSetTextures=!0}hoverStyleWatcher(t,i){this.shouldDrawInteractionState=!0,this.shouldCheckLabelColor=!0,this.shouldSetLabelOpacity=!0,this.shouldSetStrokes=!0}clickStyleWatcher(t,i){this.shouldDrawInteractionState=!0,this.shouldSetSelectionClass=!0,this.shouldCheckLabelColor=!0,this.shouldSetLabelOpacity=!0,this.shouldSetStrokes=!0}referenceWatcher(t,i){this.shouldUpdateReferenceLines=!0}cursorWatcher(t,i){this.shouldUpdateCursor=!0}cornerWatcher(t,i){this.shouldUpdateCorners=!0}intervalRatioWatcher(t,i){this.shouldUpdateScales=!0,this.shouldUpdateGeometries=!0,this.shouldSetLabelOpacity=!0,this.shouldCheckLabelAxis=!0,this.shouldUpdateLabels=!0,this.shouldUpdateAnnotations=!0}hoverOpacityWatcher(t,i){this.shouldDrawInteractionState=!0,this.shouldCheckLabelColor=!0,this.shouldSetLabelOpacity=!0}labelWatcher(t,i){this.shouldUpdateLabels=!0,this.shouldUpdateTotalLabels=!0,this.shouldUpdateGeometries=!0,this.shouldUpdateTableData=!0;const s=!(!t||!t.placement)&&t.placement,h=!(!i||!i.placement)&&i.placement,e=!(!t||!t.labelAccessor)&&t.labelAccessor,a=!(!i||!i.labelAccessor)&&i.labelAccessor;(t&&t.visible)!==(i&&i.visible)&&(this.shouldSetLabelOpacity=!0),s!==h&&(this.shouldSetLabelOpacity=!0,this.shouldValidateLabelPlacement=!0,this.shouldCheckLabelColor=!0),e!==a&&(this.shouldValidateDataLabelAccessor=!0)}showTotalValueWatcher(t,i){this.shouldUpdateTotalLabels=!0,this.shouldUpdateTableData=!0,this.shouldSetGroupAccessibilityLabel=!0,this.shouldSetParentSVGAccessibility=!0,this.shouldSetGeometryAriaLabels=!0}showTooltipWatcher(t,i){this.shouldDrawInteractionState=!0}tooltipLabelWatcher(t,i){this.shouldUpdateTableData=!0,this.shouldSetParentSVGAccessibility=!0,this.shouldSetGeometryAriaLabels=!0}accessibilityWatcher(t,i){this.shouldValidate=!0,(!(!t||!t.title)&&t.title)!==(!(!i||!i.title)&&i.title)&&(this.shouldUpdateDescriptionWrapper=!0,this.shouldSetChartAccessibilityTitle=!0,this.shouldSetParentSVGAccessibility=!0),(!(!t||!t.executiveSummary)&&t.executiveSummary)!==(!(!i||!i.executiveSummary)&&i.executiveSummary)&&(this.shouldSetChartAccessibilityExecutiveSummary=!0),(!(!t||!t.purpose)&&t.purpose)!==(!(!i||!i.purpose)&&i.purpose)&&(this.shouldSetChartAccessibilityPurpose=!0),(!(!t||!t.longDescription)&&t.longDescription)!==(!(!i||!i.longDescription)&&i.longDescription)&&(this.shouldSetChartAccessibilityLongDescription=!0),(!(!t||!t.contextExplanation)&&t.contextExplanation)!==(!(!i||!i.contextExplanation)&&i.contextExplanation)&&(this.shouldSetChartAccessibilityContext=!0),(!(!t||!t.statisticalNotes)&&t.statisticalNotes)!==(!(!i||!i.statisticalNotes)&&i.statisticalNotes)&&(this.shouldSetChartAccessibilityStatisticalNotes=!0),(!(!t||!t.structureNotes)&&t.structureNotes)!==(!(!i||!i.structureNotes)&&i.structureNotes)&&(this.shouldSetChartAccessibilityStructureNotes=!0);const s=t&&t.includeDataKeyNames,h=i&&i.includeDataKeyNames;s===h&&(!(!t||!t.elementDescriptionAccessor)&&t.elementDescriptionAccessor)===(!(!i||!i.elementDescriptionAccessor)&&i.elementDescriptionAccessor)||(s!==h&&(this.shouldSetGroupAccessibilityLabel=!0),this.shouldSetGeometryAriaLabels=!0,this.shouldSetParentSVGAccessibility=!0),(!(!t||!t.hideTextures)&&t.hideTextures)!==(!(!i||!i.hideTextures)&&i.hideTextures)&&(this.shouldSetTextures=!0,this.shouldUpdateLegend=!0,this.shouldDrawInteractionState=!0),(!(!t||!t.showSmallLabels)&&t.showSmallLabels)!==(!(!i||!i.showSmallLabels)&&i.showSmallLabels)&&(this.shouldSetLabelOpacity=!0),(!(!t||!t.hideStrokes)&&t.hideStrokes)!==(!(!i||!i.hideStrokes)&&i.hideStrokes)&&(this.shouldSetStrokes=!0,this.shouldUpdateLegend=!0,this.shouldDrawInteractionState=!0);const e=!(!t||!t.elementsAreInterface)&&t.elementsAreInterface,a=!(!i||!i.elementsAreInterface)&&i.elementsAreInterface;(!!(t&&t.keyboardNavConfig&&t.keyboardNavConfig.disabled)&&t.keyboardNavConfig.disabled)===(!!(i&&i.keyboardNavConfig&&i.keyboardNavConfig.disabled)&&i.keyboardNavConfig.disabled)&&e===a||(this.shouldSetGeometryAriaLabels=!0,this.shouldSetParentSVGAccessibility=!0,this.shouldUpdateDescriptionWrapper=!0,this.shouldRedrawWrapper=!0,this.shouldSetChartAccessibilityTitle=!0,this.shouldSetChartAccessibilitySubtitle=!0,this.shouldSetChartAccessibilityLongDescription=!0,this.shouldSetChartAccessibilityContext=!0,this.shouldSetChartAccessibilityExecutiveSummary=!0,this.shouldSetChartAccessibilityPurpose=!0,this.shouldSetChartAccessibilityStatisticalNotes=!0,this.shouldSetChartAccessibilityStructureNotes=!0),e!==a&&(this.shouldSetSelectionClass=!0)}showZeroLabelsWatcher(t,i){this.shouldUpdateLabels=!0}legendWatcher(t,i){this.shouldUpdateLegend=!0,(t&&t.interactive)!==(i&&i.interactive)&&(this.shouldUpdateLegendInteractivity=!0)}annotationsWatcher(t,i){this.shouldValidate=!0,this.shouldUpdateAnnotations=!0,this.shouldSetAnnotationAccessibility=!0}valueOverrideWatcher(t,i){this.shouldUpdateScales=!0,this.shouldCheckValueAxis=!0,this.shouldUpdateGeometries=!0,this.shouldUpdateLabels=!0,this.shouldUpdateTotalLabels=!0,this.shouldUpdateReferenceLines=!0,this.shouldUpdateBaseline=!0,this.shouldUpdateAnnotations=!0}interactionWatcher(t,i){this.shouldValidateInteractionKeys=!0,this.shouldDrawInteractionState=!0,this.shouldCheckLabelColor=!0,this.shouldSetLabelOpacity=!0,this.shouldSetSelectionClass=!0,this.shouldUpdateTableData=!0,this.shouldSetGeometryAriaLabels=!0}dataKeyNamesWatcher(t,i){this.shouldUpdateXAxis=!0,this.shouldSetXAxisAccessibility=!0,this.shouldUpdateYAxis=!0,this.shouldSetYAxisAccessibility=!0,this.shouldSetParentSVGAccessibility=!0,this.shouldSetGroupAccessibilityLabel=!0,this.shouldSetGeometryAriaLabels=!0}hoverWatcher(t,i){this.shouldDrawInteractionState=!0,this.shouldCheckLabelColor=!0,this.shouldSetLabelOpacity=!0}clickWatcher(t,i){this.shouldValidateClickHighlight=!0,this.shouldDrawInteractionState=!0,this.shouldCheckLabelColor=!0,this.shouldSetLabelOpacity=!0}suppressWatcher(t,i){this.shouldBindInteractivity=!0,this.shouldUpdateCursor=!0,this.shouldUpdateLegendInteractivity=!0,this.shouldSetGeometryAriaLabels=!0,this.shouldSetParentSVGAccessibility=!0,this.shouldUpdateDescriptionWrapper=!0,this.shouldRedrawWrapper=!0,this.shouldValidate=!0,this.shouldSetChartAccessibilityTitle=!0,this.shouldSetChartAccessibilitySubtitle=!0,this.shouldSetChartAccessibilityLongDescription=!0,this.shouldSetChartAccessibilityContext=!0,this.shouldSetChartAccessibilityExecutiveSummary=!0,this.shouldSetChartAccessibilityPurpose=!0,this.shouldSetChartAccessibilityStatisticalNotes=!0,this.shouldSetChartAccessibilityStructureNotes=!0}unitTestWatcher(t,i){this.shouldSetTestingAttributes=!0}componentWillLoad(){const t=this.uniqueID||"stacked-bar-chart-"+n();return this.initialLoadEvent.emit({chartID:t}),new Promise((i=>{this.duration=0,this.defaults=!0,this.chartID=t,this.stackedBarChartEl.id=this.chartID,this.setTagLevels(),this.prepareData(),this.prepareLegendData(),this.setDimensions(),this.prepareScales(),this.validateClickHighlight(),this.validateInteractionKeys(),this.validateDataLabelAccessor(),this.validateAxes(),this.setTableData(),this.shouldValidateAccessibilityProps(),this.setColors(),i("component will load")}))}componentWillUpdate(){return new Promise((t=>{t("component will update")}))}componentDidLoad(){return new Promise((t=>{this.renderRootElements(),this.setTooltipInitialStyle(),this.setChartDescriptionWrapper(),this.setChartAccessibilityTitle(),this.setChartAccessibilitySubtitle(),this.setChartAccessibilityLongDescription(),this.setChartAccessibilityExecutiveSummary(),this.setChartAccessibilityPurpose(),this.setChartAccessibilityContext(),this.setChartAccessibilityStatisticalNotes(),this.setChartAccessibilityStructureNotes(),this.setParentSVGAccessibility(),this.reSetRoot(),this.setTextures(),this.setStrokes(),this.drawXGrid(),this.drawYGrid(),this.setGlobalSelections(),this.setTestingAttributes(),this.enterGeometries(),this.updateGeometries(),this.exitGeometries(),this.setRoundedCorners(),this.drawGeometries(),this.enterDataLabels(),this.updateDataLabels(),this.exitDataLabels(),this.enterTotalDataLabels(),this.updateTotalDataLabels(),this.exitTotalDataLabels(),this.setChartCountAccessibility(),this.setGeometryAccessibilityAttributes(),this.setGeometryAriaLabels(),this.drawLegendElements(),this.bindLegendInteractivity(),this.validateLabelPlacement(),this.drawDataLabels(),this.drawTotalDataLabels(),this.drawReferenceLines(),this.setSelectedClass(),this.checkLabelColorAgainstBackground(),this.updateCursor(),this.bindInteractivity(),this.drawAnnotations(),this.setAnnotationAccessibility(),this.drawXAxis(),this.setXAxisAccessibility(),this.drawYAxis(),this.setYAxisAccessibility(),this.drawBaseline(),O(this.root.node(),this.barG.node()),this.setGroupAccessibilityID(),this.onChangeHandler(),this.defaults=!1,t("component did load")})).then((()=>this.initialLoadEndEvent.emit({chartID:this.chartID})))}componentDidUpdate(){return new Promise((t=>{this.duration=this.animationConfig&&this.animationConfig.disabled?0:750,this.shouldUpdateDescriptionWrapper&&(this.setChartDescriptionWrapper(),this.shouldUpdateDescriptionWrapper=!1),this.shouldSetChartAccessibilityCount&&(this.setChartCountAccessibility(),this.shouldSetChartAccessibilityCount=!1),this.shouldSetChartAccessibilityTitle&&(this.setChartAccessibilityTitle(),this.shouldSetChartAccessibilityTitle=!1),this.shouldSetChartAccessibilitySubtitle&&(this.setChartAccessibilitySubtitle(),this.shouldSetChartAccessibilitySubtitle=!1),this.shouldSetChartAccessibilityLongDescription&&(this.setChartAccessibilityLongDescription(),this.shouldSetChartAccessibilityLongDescription=!1),this.shouldSetChartAccessibilityExecutiveSummary&&(this.setChartAccessibilityExecutiveSummary(),this.shouldSetChartAccessibilityExecutiveSummary=!1),this.shouldSetChartAccessibilityPurpose&&(this.setChartAccessibilityPurpose(),this.shouldSetChartAccessibilityPurpose=!1),this.shouldSetChartAccessibilityContext&&(this.setChartAccessibilityContext(),this.shouldSetChartAccessibilityContext=!1),this.shouldSetChartAccessibilityStatisticalNotes&&(this.setChartAccessibilityStatisticalNotes(),this.shouldSetChartAccessibilityStatisticalNotes=!1),this.shouldSetChartAccessibilityStructureNotes&&(this.setChartAccessibilityStructureNotes(),this.shouldSetChartAccessibilityStructureNotes=!1),this.shouldSetParentSVGAccessibility&&(this.setParentSVGAccessibility(),this.shouldSetParentSVGAccessibility=!1),this.shouldResetRoot&&(this.reSetRoot(),this.shouldResetRoot=!1),this.shouldSetTextures&&(this.setTextures(),this.shouldSetTextures=!1),this.shouldSetStrokes&&(this.setStrokes(),this.shouldSetStrokes=!1),this.shouldSetGlobalSelections&&(this.setGlobalSelections(),this.shouldSetGlobalSelections=!1),this.shouldSetTestingAttributes&&(this.setTestingAttributes(),this.shouldSetTestingAttributes=!1),this.shouldUpdateXGrid&&(this.drawXGrid(),this.shouldUpdateXGrid=!1),this.shouldUpdateYGrid&&(this.drawYGrid(),this.shouldUpdateYGrid=!1),this.shouldEnterUpdateExit&&(this.enterGeometries(),this.updateGeometries(),this.exitGeometries(),this.enterDataLabels(),this.updateDataLabels(),this.exitDataLabels(),this.enterTotalDataLabels(),this.updateTotalDataLabels(),this.exitTotalDataLabels(),this.shouldEnterUpdateExit=!1),this.shouldUpdateCorners&&(this.setRoundedCorners(),this.shouldUpdateCorners=!1),this.shouldUpdateGeometries&&(this.drawGeometries(),this.shouldUpdateGeometries=!1),this.shouldSetGeometryAccessibilityAttributes&&(this.setGeometryAccessibilityAttributes(),this.shouldSetGeometryAccessibilityAttributes=!1),this.shouldSetGeometryAriaLabels&&(this.setGeometryAriaLabels(),this.shouldSetGeometryAriaLabels=!1),this.shouldSetGroupAccessibilityLabel&&(this.setGroupAccessibilityID(),this.shouldSetGroupAccessibilityLabel=!1),this.shouldUpdateLegend&&(this.drawLegendElements(),this.shouldUpdateLegend=!1),this.shouldUpdateLabels&&(this.drawDataLabels(),this.shouldUpdateLabels=!1),this.shouldUpdateTotalLabels&&(this.drawTotalDataLabels(),this.shouldUpdateTotalLabels=!1),this.shouldUpdateReferenceLines&&(this.drawReferenceLines(),this.shouldUpdateReferenceLines=!1),this.shouldDrawInteractionState&&(this.updateInteractionState(),this.shouldDrawInteractionState=!1),this.shouldSetLabelOpacity&&(this.setLabelOpacity(),this.shouldSetLabelOpacity=!1),this.shouldCheckLabelColor&&(this.checkLabelColorAgainstBackground(),this.shouldCheckLabelColor=!1),this.shouldSetSelectionClass&&(this.setSelectedClass(),this.shouldSetSelectionClass=!1),this.shouldUpdateLegendInteractivity&&(this.bindLegendInteractivity(),this.shouldUpdateLegendInteractivity=!1),this.shouldUpdateCursor&&(this.updateCursor(),this.shouldUpdateCursor=!1),this.shouldBindInteractivity&&(this.bindInteractivity(),this.shouldBindInteractivity=!1),this.shouldUpdateAnnotations&&(this.drawAnnotations(),this.shouldUpdateAnnotations=!1),this.shouldSetAnnotationAccessibility&&(this.setAnnotationAccessibility(),this.shouldSetAnnotationAccessibility=!1),this.shouldUpdateXAxis&&(this.drawXAxis(),this.shouldUpdateXAxis=!1),this.shouldSetXAxisAccessibility&&(this.setXAxisAccessibility(),this.shouldSetXAxisAccessibility=!1),this.shouldUpdateYAxis&&(this.drawYAxis(),this.shouldUpdateYAxis=!1),this.shouldSetYAxisAccessibility&&(this.setYAxisAccessibility(),this.shouldSetYAxisAccessibility=!1),this.shouldUpdateBaseline&&(this.drawBaseline(),this.shouldUpdateBaseline=!1),this.onChangeHandler(),t("component did update")})).then((()=>this.drawEndEvent.emit({chartID:this.chartID})))}shouldValidateAccessibilityProps(){this.shouldValidateAccessibility&&!this.accessibility.disableValidation&&(this.shouldValidateAccessibility=!1,kt(this.chartID,this.accessibility,{annotations:this.annotations,data:this.data,uniqueID:this.uniqueID,context:{mainTitle:this.mainTitle,onClickEvent:this.suppressEvents?void 0:this.clickEvent.emit,tooltipLabel:this.tooltipLabel,dataLabel:this.dataLabel,valueAccessor:this.valueAccessor},misc:{normalized:this.normalized}}))}validateLabelPlacement(){"vertical"===this.layout?"top"!==this.dataLabel.placement&&"middle"!==this.dataLabel.placement&&"bottom"!==this.dataLabel.placement&&"auto"!==this.dataLabel.placement&&(this.dataLabel.placement="middle"):"end"!==this.dataLabel.placement&&"middle"!==this.dataLabel.placement&&"base"!==this.dataLabel.placement&&"auto"!==this.dataLabel.placement&&(this.dataLabel.placement="middle")}validateInteractionKeys(){this.innerInteractionKeys=this.interactionKeys&&this.interactionKeys.length?this.interactionKeys:[this.ordinalAccessor]}validateDataLabelAccessor(){this.innerLabelAccessor=this.dataLabel.labelAccessor?this.dataLabel.labelAccessor:this.valueAccessor}validateAxes(){this.innerXAxis=Object.assign(Object.assign({},this.xAxis),{gridVisible:!("vertical"===this.layout)&&this.xAxis.gridVisible}),this.innerYAxis=Object.assign(Object.assign({},this.yAxis),{gridVisible:"vertical"===this.layout&&this.yAxis.gridVisible})}setDimensions(){this.padding="string"==typeof this.padding?nt(this.padding):this.padding,this.innerHeight=this.height-this.margin.top-this.margin.bottom,this.innerWidth=this.width-this.margin.left-this.margin.right,this.innerPaddedHeight=this.innerHeight-this.padding.top-this.padding.bottom,this.innerPaddedWidth=this.innerWidth-this.padding.left-this.padding.right}prepareData(){this.extent=[0,0];const t=[];this.data.forEach((i=>{const s=Object.keys(i),h={};s.forEach((t=>{h[t]=i[t]instanceof Date?new Date(i[t].getTime()):i[t]})),t.push(h)}));const i=a().key((t=>(t[this.valueAccessor]=parseFloat(t[this.valueAccessor]),t[this.groupAccessor]=t[this.groupAccessor]instanceof Date?ct({date:t[this.groupAccessor],format:"vertical"===this.layout?this.xAxis.format:this.yAxis.format,offsetTimezone:!0}):t[this.groupAccessor],t[this.groupAccessor]))).entries(t);this.interpolating=this.series.length?this.series:"",this.interpolating&&(this.interpolating.stackOrder=this.stackOrder);const s={},h=t=>{let i=0;const h=t.length,e=[];for(this.stackOrder={},i=0;i<h;i++){const h=Object.assign({},t[i]);let a=0,r=0,o=0;const c={positive:0,negative:0},l=t[i].values,n=l.length;h.values=[];let d=0;for(a=0;a<n;a++){const t=Object.assign({},l[a]),i=t[this.valueAccessor];i>=0?(t.stackEnd=c.positive,c.positive+=i,t.stackStart=c.positive):(t.stackStart=c.negative,c.negative+=i,t.stackEnd=c.negative);let e=this.stackOrder[t[this.groupAccessor]];if(e||(this.stackOrder[t[this.groupAccessor]]={},e=this.stackOrder[t[this.groupAccessor]]),e[t[this.ordinalAccessor]]||(e[t[this.ordinalAccessor]]={previous:d,value:i,stackStart:t.stackStart,stackEnd:t.stackEnd}),t.enteringStackStart=!1,this.interpolating&&this.interpolating.stackOrder[t[this.groupAccessor]]){const s=this.interpolating.stackOrder[t[this.groupAccessor]],h=t=>{if(0===t)return 0;if(s[t]){if(i>=0&&s[t].value>=0)return s[t].stackStart;if(i<0&&s[t].value<0)return s[t].stackEnd}return h(e[t].previous)};s[t[this.ordinalAccessor]]||(t.enteringStackStart=h(d))}d=t[this.ordinalAccessor],t.getSum=()=>h.sum,r+=i,i>0&&(o+=i),s[t[this.ordinalAccessor]]||(s[t[this.ordinalAccessor]]=1),h.values.push(t)}c.positive>this.extent[1]&&(this.extent[1]=c.positive),c.negative<this.extent[0]&&(this.extent[0]=c.negative),h.sum=r,h.sumMessage="Sum "+r,h.sumAboveZero=o,e.push(h)}return e};h(i),this.datakeys=Object.keys(s),this.series=h(i),"asc"===this.sortOrder?this.series=[...this.series].sort(((t,i)=>t.sum-i.sum)):"desc"===this.sortOrder&&(this.series=[...this.series].sort(((t,i)=>i.sum-t.sum)))}prepareLegendData(){this.legendData=this.series[0].values}validateClickHighlight(){this.clickHighlight&&this.clickHighlight.length>0&&this.clickHighlight.map((t=>{t[this.groupAccessor]=t[this.groupAccessor]instanceof Date?ct({date:t[this.groupAccessor],format:"vertical"===this.layout?this.xAxis.format:this.yAxis.format,offsetTimezone:!0}):t[this.groupAccessor]}))}setTableData(){const t=[];this.series.forEach((i=>{i.values.forEach((i=>{t.push(i)}))}));const i=yt(this,U,"stacked-bar-chart");this.tableData=bt(t,i),this.tableColumns=Object.keys(i)}setColors(){this.preparedColors=this.colors?it(this.colors):dt(this.colorPalette,this.datakeys.length)}setTextures(){const t=this.preparedColors.range?this.preparedColors.range():this.preparedColors;if(this.accessibility.hideTextures||t.length>6)this.colorArr=this.preparedColors;else{const i=W({colors:t,rootSVG:this.svg.node(),id:this.chartID,scheme:"categorical",disableTransitions:!this.duration});this.colorArr=this.preparedColors.range?this.preparedColors.copy().range(i):i}}setStrokes(){const t=this.preparedColors.range?this.preparedColors.range():this.preparedColors;this.strokes=A({root:this.svg.node(),id:this.chartID,colors:t,clickStyle:this.clickStyle,hoverStyle:this.hoverStyle,stacked:!0}),this.textStrokes={},t.forEach((t=>{this.textStrokes[t]=k({root:this.svg.node(),id:this.chartID,color:t})})),this.clickStyle&&this.clickStyle.color&&(this.textStrokes[this.clickStyle.color]=k({root:this.svg.node(),id:this.chartID,color:this.clickStyle.color})),this.hoverStyle&&this.hoverStyle.color&&(this.textStrokes[this.hoverStyle.color]=k({root:this.svg.node(),id:this.chartID,color:this.hoverStyle.color}))}prepareScales(){const t=this.normalized?[0,1]:[this.minValueOverride&&this.minValueOverride<this.extent[0]?this.minValueOverride:this.extent[0],this.maxValueOverride||this.extent[1]];this.interpolating&&(this.interpolating.oldXDomain=this.x.domain(),this.interpolating.oldXRange=this.x.range(),this.interpolating.oldYDomain=this.y.domain(),this.interpolating.oldYRange=this.y.range()),"vertical"===this.layout?(this.interpolating&&(this.interpolating.padding=this.x.padding(),this.interpolating.x=e().domain(this.interpolating.oldXDomain).range(this.interpolating.oldXRange).padding(this.interpolating.padding),this.interpolating.y=r().domain(this.interpolating.oldYDomain).range(this.interpolating.oldYRange)),this.y=r().domain(t).range([this.innerPaddedHeight,0]),this.x=e().domain(this.series.map((t=>t.key))).range([0,this.innerPaddedWidth]).padding(this.barIntervalRatio)):"horizontal"===this.layout&&(this.interpolating&&(this.interpolating.padding=this.y.padding(),this.interpolating.x=r().domain(this.interpolating.oldXDomain).range(this.interpolating.oldXRange),this.interpolating.y=e().domain(this.interpolating.oldYDomain).range(this.interpolating.oldYRange).padding(this.interpolating.padding)),this.x=r().domain(t).range([0,this.innerPaddedWidth]),this.y=e().domain(this.series.map((t=>t.key))).range([0,this.innerPaddedHeight]).padding(this.barIntervalRatio))}renderRootElements(){this.svg=u(this.stackedBarChartEl).select(".visa-viz-d3-stacked-bar-container").append("svg").attr("width",this.width).attr("height",this.height).attr("viewBox","0 0 "+this.width+" "+this.height),this.root=this.svg.append("g").attr("id","visa-viz-margin-container-g-"+this.chartID),this.rootG=this.root.append("g").attr("id","visa-viz-padding-container-g-"+this.chartID),this.gridG=this.rootG.append("g").attr("class","grid-group"),this.barG=this.rootG.append("g").attr("class","stacked-bar-group"),this.labelG=this.rootG.append("g").attr("class","stacked-bar-dataLabel-group"),this.totalLabels=this.rootG.append("g").attr("class","bar-dataLabel-group"),this.legendG=u(this.stackedBarChartEl).select(".stacked-bar-legend").append("svg"),this.tooltipG=u(this.stackedBarChartEl).select(".stacked-bar-tooltip"),this.references=this.rootG.append("g").attr("class","stacked-bar-reference-line-group")}setTestingAttributes(){this.unitTest?(u(this.stackedBarChartEl).select(".visa-viz-d3-stacked-bar-container").attr("data-testid","chart-container"),u(this.stackedBarChartEl).select(".stacked-bar-main-title").attr("data-testid","main-title"),u(this.stackedBarChartEl).select(".stacked-bar-sub-title").attr("data-testid","sub-title"),this.svg.attr("data-testid","root-svg"),this.root.attr("data-testid","margin-container"),this.rootG.attr("data-testid","padding-container"),this.legendG.attr("data-testid","legend-container"),this.tooltipG.attr("data-testid","tooltip-container"),this.barG.attr("data-testid","stacked-bar-group"),this.updateBarWrappers.attr("data-testid","stacked-bar-wrapper").attr("data-id",(t=>`stacked-bar-wrapper-${t.key}`)),this.update.attr("data-testid","bar").attr("data-id",(t=>`bar-${t[this.groupAccessor]}-${t[this.ordinalAccessor]}`)),this.labelG.attr("data-testid","stacked-bar-dataLabel-group"),this.updateLabelWrappers.attr("data-testid","stacked-bar-dataLabel-wrapper").attr("data-id",(t=>`stacked-bar-dataLabel-wrapper-${t.key}`)),this.updateLabels.attr("data-testid","dataLabel").attr("data-id",(t=>`dataLabel-${t[this.groupAccessor]}-${t[this.ordinalAccessor]}`)),this.totalLabels.attr("data-testid","stacked-bar-totalLabel-group"),this.updateTotalLabels.attr("data-testid","totalLabel").attr("data-id",(t=>`totalLabel-${t.key}`)),this.references.attr("data-testid","reference-line-group"),this.svg.select("defs").attr("data-testid","pattern-defs"),this.references.selectAll(".stacked-bar-reference-line").attr("data-testid","reference-line"),this.references.selectAll(".stacked-bar-reference-line-label").attr("data-testid","reference-line-label")):(u(this.stackedBarChartEl).select(".visa-viz-d3-stacked-bar-container").attr("data-testid",null),u(this.stackedBarChartEl).select(".stacked-bar-main-title").attr("data-testid",null),u(this.stackedBarChartEl).select(".stacked-bar-sub-title").attr("data-testid",null),this.svg.attr("data-testid",null),this.root.attr("data-testid",null),this.rootG.attr("data-testid",null),this.legendG.attr("data-testid",null),this.tooltipG.attr("data-testid",null),this.barG.attr("data-testid",null),this.updateBarWrappers.attr("data-testid",null).attr("data-id",null),this.update.attr("data-testid",null).attr("data-id",null),this.labelG.attr("data-testid",null),this.updateLabelWrappers.attr("data-testid",null).attr("data-id",null),this.updateLabels.attr("data-testid",null).attr("data-id",null),this.totalLabels.attr("data-testid",null),this.updateTotalLabels.attr("data-testid",null).attr("data-id",null),this.references.attr("data-testid",null),this.svg.select("defs").attr("data-testid",null),this.references.selectAll(".stacked-bar-reference-line").attr("data-testid",null),this.references.selectAll(".stacked-bar-reference-line-label").attr("data-testid",null))}reSetRoot(){S({selection:this.svg,duration:this.duration,namespace:"root_reset",easing:p}).attr("width",this.width).attr("height",this.height).attr("viewBox","0 0 "+this.width+" "+this.height),S({selection:this.root,duration:this.duration,namespace:"root_reset",easing:p}).attr("transform",`translate(${this.margin.left}, ${this.margin.top})`),S({selection:this.rootG,duration:this.duration,namespace:"root_reset",easing:p}).attr("transform",`translate(${this.padding.left}, ${this.padding.top})`),X(this.chartID,this.width)}drawXAxis(){const t="vertical"===this.layout?this.groupAccessor:this.valueAccessor,i=this.xAxis.label&&""!==this.xAxis.label?this.xAxis.label:this.dataKeyNames&&this.dataKeyNames[t]?this.dataKeyNames[t]:this.xAxis.label;st({root:this.rootG,height:this.innerPaddedHeight,width:this.innerPaddedWidth,axisScale:this.x,left:!1,wrapLabel:this.wrapLabel&&"vertical"===this.layout?this.x.bandwidth():"",format:this.xAxis.format,dateFormat:this.xAxis.format,tickInterval:this.xAxis.tickInterval,label:i,padding:this.padding,hide:!this.innerXAxis.visible,duration:this.duration})}drawYAxis(){const t="vertical"===this.layout?this.valueAccessor:this.groupAccessor;st({root:this.rootG,height:this.innerPaddedHeight,width:this.innerPaddedWidth,axisScale:this.y,left:!0,wrapLabel:this.wrapLabel?this.padding.left||100:"",format:this.yAxis.format,dateFormat:this.yAxis.format,tickInterval:this.yAxis.tickInterval,label:this.yAxis.label&&""!==this.yAxis.label?this.yAxis.label:this.dataKeyNames&&this.dataKeyNames[t]?this.dataKeyNames[t]:this.yAxis.label,padding:this.padding,hide:!this.innerYAxis.visible,duration:this.duration})}setXAxisAccessibility(){const t="vertical"===this.layout?this.groupAccessor:this.valueAccessor;V({rootEle:this.stackedBarChartEl,hasXAxis:!!this.innerXAxis&&this.innerXAxis.visible,xAxis:"vertical"===this.layout?this.x||!1:this.y||!1,xAxisLabel:(this.xAxis.label&&""!==this.xAxis.label?this.xAxis.label:this.dataKeyNames&&this.dataKeyNames[t]?this.dataKeyNames[t]:this.xAxis.label)||""})}setYAxisAccessibility(){const t="vertical"===this.layout?this.valueAccessor:this.groupAccessor;M({rootEle:this.stackedBarChartEl,hasYAxis:!!this.innerYAxis&&this.innerYAxis.visible,yAxis:"vertical"===this.layout?this.y||!1:this.x||!1,yAxisLabel:(this.yAxis.label&&""!==this.yAxis.label?this.yAxis.label:this.dataKeyNames&&this.dataKeyNames[t]?this.dataKeyNames[t]:this.yAxis.label)||""})}drawBaseline(){"vertical"===this.layout&&st({root:this.rootG,height:this.innerPaddedHeight,width:this.innerPaddedWidth,axisScale:this.x,left:!1,padding:this.padding,markOffset:this.y(0)||-1,duration:this.duration}),"horizontal"===this.layout&&st({root:this.rootG,height:this.innerPaddedHeight,width:this.innerPaddedWidth,axisScale:this.y,left:!0,padding:this.padding,markOffset:this.x(0)||-1,duration:this.duration})}drawXGrid(){ht(this.gridG,this.innerPaddedHeight,this.innerPaddedWidth,this.x,!1,!this.innerXAxis.gridVisible,this.xAxis.tickInterval,this.duration)}drawYGrid(){ht(this.gridG,this.innerPaddedHeight,this.innerPaddedWidth,this.y,!0,!this.innerYAxis.gridVisible,this.yAxis.tickInterval,this.duration)}setGlobalSelections(){const t=this.barG.selectAll(".stacked-bar-series").data(this.series,(t=>t.key));this.enterBarWrappers=t.enter().append("g"),this.exitBarWrappers=t.exit(),this.updateBarWrappers=t.merge(this.enterBarWrappers);const i=this.updateBarWrappers.selectAll(".stacked-bar").data((t=>t.values),(t=>t[this.ordinalAccessor]));this.enter=i.enter().append("rect"),this.exit=i.exit(),this.update=i.merge(this.enter),this.exitSize=this.exit.size(),this.enterSize=this.enter.size();const s=this.labelG.selectAll(".stacked-bar-dataLabel-series").data(this.series,(t=>t.key));this.enterLabelWrappers=s.enter().append("g"),this.exitLabelWrappers=s.exit(),this.updateLabelWrappers=s.merge(this.enterLabelWrappers);const h=this.updateLabelWrappers.selectAll(".stacked-bar-dataLabel").data((t=>t.values),(t=>t[this.ordinalAccessor]));this.enterLabels=h.enter().append("text"),this.exitLabels=h.exit(),this.updateLabels=h.merge(this.enterLabels);const e=this.totalLabels.selectAll(".bar-dataLabel-group text").data(this.series,(t=>t.key));this.enterTotalLabels=e.enter().append("text"),this.exitTotalLabels=e.exit(),this.updateTotalLabels=e.merge(this.enterTotalLabels)}enterGeometries(){this.enter.interrupt();const t="vertical"===this.layout?"x":"y",i="vertical"===this.layout?"width":"height",s="vertical"===this.layout?"y":"x",h="vertical"===this.layout?"height":"width",e="vertical"===this.layout?"innerPaddedWidth":"innerPaddedHeight";this.enter.attr("class","stacked-bar").attr("cursor",this.suppressEvents?null:this.cursor).each(((t,i,s)=>{D(s[i])})).on("click",this.suppressEvents?null:(t,i,s)=>this.onClickHandler(t,s[i])).on("mouseover",this.suppressEvents?null:(t,i,s)=>this.onHoverHandler(t,s[i])).on("mouseout",this.suppressEvents?null:()=>this.onMouseOutHandler()).attr("fill",((t,i)=>{const s=this.clickHighlight&&this.clickHighlight.length>0&&Q(t,this.clickHighlight,this.innerInteractionKeys),h=this.hoverHighlight&&tt(t,this.hoverHighlight,this.innerInteractionKeys),e=this.colorArr[i];return s&&this.clickStyle.color?ft[this.clickStyle.color]||this.clickStyle.color:s?e:h&&this.hoverStyle.color?ft[this.hoverStyle.color]||this.hoverStyle.color:e})).attr("opacity",0).attr(s,(t=>{let i=this[s];this.interpolating&&(i=this.interpolating[s]);let h=t.stackEnd;return t.stackEnd<0&&(h=t.stackStart),"number"==typeof t.enteringStackStart&&(h=t.enteringStackStart),i(h/(this.normalized?t.getSum():1))})).attr(h,0).attr(t,(i=>{let s=this[t];return this.interpolating&&(s=this.interpolating[t]),s(i[this.groupAccessor])})).attr(i,(()=>{let i=this[t];return this.interpolating&&(i=this.interpolating[t]),i.bandwidth()})),this.enterBarWrappers.attr("class","stacked-bar-series entering").each(((t,i,s)=>{D(s[i])})).selectAll(".stacked-bar").attr(h,(t=>{const i=this.normalized?t.getSum():1;return"vertical"===this.layout?this.y(t.stackEnd/i)-this.y(t.stackStart/i):this.x(t.stackStart/i)-this.x(t.stackEnd/i)})),this.enterBarWrappers.selectAll(".stacked-bar").attr(s,(t=>{const i=this.normalized?t.getSum():1;return"vertical"===this.layout?this.y(t.stackStart/i):this.x(t.stackEnd/i)})).attr(t,(i=>{let s=this[t](i[this.groupAccessor])+this[t].bandwidth()/2;return s=this[t](i[this.groupAccessor])+this[t].bandwidth()/2*(s/(this[e]/2)),s})).attr(i,0),this.enterBarWrappers.order(),this.enter.order()}updateGeometries(){this.update.interrupt(),this.update.transition("opacity").duration(((t,i,s)=>u(s[i]).classed("entering")?(u(s[i]).classed("entering",!1),this.duration):0)).ease(p).attr("opacity",(t=>J(t,1,this.hoverOpacity,this.hoverHighlight,this.clickHighlight,this.innerInteractionKeys))).call(mt,(()=>{this.update.classed("entering",!1)}))}exitGeometries(){this.exit.interrupt();const t="vertical"===this.layout?"x":"y",i="vertical"===this.layout?"width":"height",s="vertical"===this.layout?"y":"x",h="vertical"===this.layout?"height":"width",e="vertical"===this.layout?"innerPaddedWidth":"innerPaddedHeight";this.exit.attr("filter",null).transition("exit").duration(this.duration).ease(p).attr(h,0).attr(s,(t=>{let i=t.stackEnd;t.stackEnd<0&&(i=t.stackStart);const h=this.normalized?t.getSum():1;return this[s](i/h)})).attr(t,(i=>this[t](i[this.groupAccessor]))),this.exitBarWrappers.selectAll(".stacked-bar").attr("filter",null).transition("exit").duration(this.duration).ease(p).attr("opacity",0).attr(s,((t,i,h)=>u(h[i]).attr(s))).attr(t,((s,h,a)=>{const r=u(a[h]);let o=+r.attr(t)+ +r.attr(i)/2;return o=+r.attr(t)+ +r.attr(i)/2*(o/(this[e]/2)),o})).attr(h,((t,i,s)=>u(s[i]).attr(h))).attr(i,0),this.update.transition("accessibilityAfterExit").duration(this.duration).ease(p).call(mt,(()=>{const t=F(this.rootG.node());this.exit.remove(),this.exitBarWrappers.remove(),this.setChartCountAccessibility(),this.setGroupAccessibilityID(),this.setGeometryAriaLabels(),B({parentGNode:this.rootG.node(),focusDidExist:t})}))}drawGeometries(){const t="vertical"===this.layout?"x":"y",i="vertical"===this.layout?"width":"height",s="vertical"===this.layout?"y":"x",h="vertical"===this.layout?"height":"width";this.updateBarWrappers.transition("update").duration(this.duration).ease(p).call(mt,(()=>{this.updateBarWrappers.classed("entering",!1)})),this.update.classed("geometryIsMoving",((e,a,r)=>{const o=this.normalized?e.getSum():1;return f(u(r[a]),[{attr:t,numeric:!0,newValue:this[t](e[this.groupAccessor])},{attr:i,numeric:!0,newValue:this[t].bandwidth()},{attr:s,numeric:!0,newValue:"vertical"===this.layout?this.y(e.stackStart/o):this.x(e.stackEnd/o)},{attr:h,numeric:!0,newValue:"vertical"===this.layout?this.y(e.stackEnd/o)-this.y(e.stackStart/o):this.x(e.stackStart/o)-this.x(e.stackEnd/o)}])})).attr(`data-${t}`,(i=>this[t](i[this.groupAccessor]))).attr(`data-${i}`,this[t].bandwidth()).attr(`data-${s}`,(t=>{const i=this.normalized?t.getSum():1;return"vertical"===this.layout?this.y(t.stackStart/i):this.x(t.stackEnd/i)})).attr(`data-${h}`,(t=>{const i=this.normalized?t.getSum():1;return"vertical"===this.layout?this.y(t.stackEnd/i)-this.y(t.stackStart/i):this.x(t.stackStart/i)-this.x(t.stackEnd/i)})).attr("data-translate-x",this.padding.left+this.margin.left).attr("data-translate-y",this.padding.top+this.margin.top).transition("update").duration(this.duration).ease(p).attr(s,(t=>{const i=this.normalized?t.getSum():1;return"vertical"===this.layout?this.y(t.stackStart/i):this.x(t.stackEnd/i)})).attr(h,(t=>{const i=this.normalized?t.getSum():1;return"vertical"===this.layout?this.y(t.stackEnd/i)-this.y(t.stackStart/i):this.x(t.stackStart/i)-this.x(t.stackEnd/i)})).attr(t,(i=>this[t](i[this.groupAccessor]))).attr(i,this[t].bandwidth()).call(mt,(()=>{setTimeout((()=>{this.update.classed("geometryIsMoving",!1),this.updateInteractionState(),this.updateLabels.classed("textIsMoving",!1),this.checkLabelColorAgainstBackground()}),0),B({parentGNode:this.rootG.node()}),this.transitionEndEvent.emit({chartID:this.chartID})}))}updateInteractionState(){w(this.svg.node()),this.update.interrupt("opacity"),this.updateLabels.interrupt("opacity"),this.update.attr("opacity",(t=>J(t,1,this.hoverOpacity,this.hoverHighlight,this.clickHighlight,this.innerInteractionKeys))).attr("fill",((t,i)=>{const s=this.clickHighlight&&this.clickHighlight.length>0&&Q(t,this.clickHighlight,this.innerInteractionKeys),h=this.hoverHighlight&&tt(t,this.hoverHighlight,this.innerInteractionKeys),e=this.colorArr[i];return s&&this.clickStyle.color?ft[this.clickStyle.color]||this.clickStyle.color:s?e:h&&this.hoverStyle.color?ft[this.hoverStyle.color]||this.hoverStyle.color:e})).each(((t,i,s)=>{const h=u(s[i]);if(this.accessibility.hideStrokes||h.classed("geometryIsMoving"))h.attr("filter",null);else{const e=this.clickHighlight&&this.clickHighlight.length>0&&Q(t,this.clickHighlight,this.innerInteractionKeys),a=this.hoverHighlight&&tt(t,this.hoverHighlight,this.innerInteractionKeys),r=this.preparedColors[i],o=e?"click":a?"hover":"rest",c=e&&this.clickStyle.color?ft[this.clickStyle.color]||this.clickStyle.color:e?r:a&&this.hoverStyle.color?ft[this.hoverStyle.color]||this.hoverStyle.color:r;"hover"===o&&x({inputElement:s[i],id:this.chartID,key:t[this.ordinalAccessor]+t[this.groupAccessor],strokeWidth:this.hoverStyle.strokeWidth,fill:c});const l=this.strokes[o+c];l!==h.attr("filter")&&(this.isSafari?(h.attr("filter",null),setTimeout((()=>{h.attr("filter",l)}),0)):h.attr("filter",l))}})),B({parentGNode:this.rootG.node()}),at({root:this.legendG,uniqueID:this.chartID,interactionKeys:this.innerInteractionKeys,groupAccessor:this.ordinalAccessor,hoverHighlight:this.hoverHighlight,clickHighlight:this.clickHighlight,hoverStyle:this.hoverStyle,clickStyle:this.clickStyle,hoverOpacity:this.hoverOpacity})}setLabelOpacity(){const t="auto"===this.dataLabel.placement||this.dataLabel.collisionHideOnly,i="auto"!==this.dataLabel.placement&&this.dataLabel.collisionHideOnly;let s=15;if(this.updateLabels.each(((t,i,h)=>{if(0===i){const t=getComputedStyle(h[i]),e=parseFloat(t.fontSize);s=Math.max(e-1,1)}})),this.processLabelOpacity(this.updateLabels,t),this.updateTotalLabels.attr("opacity",this.showTotalValue&&!this.normalized?1:0),t){const t=this.updateLabels.filter(((t,i,s)=>u(s[i]).classed("collision-added"))),h=this.updateLabels.filter(((t,i,s)=>u(s[i]).classed("collision-removed"))).attr("data-use-dx",i).attr("data-use-dy",i),e={vertical:{top:{validPositions:["bottom"],offsets:[5]},middle:{validPositions:["middle"],offsets:[1]},bottom:{validPositions:["top"],offsets:[s/2]}},horizontal:{right:{validPositions:["left"],offsets:[8]},middle:{validPositions:["middle"],offsets:[1]},left:{validPositions:["right"],offsets:[20]}}},a=this.dataLabel&&this.dataLabel.collisionPlacement,r=a&&e[this.layout][a]?this.dataLabel.collisionPlacement:"vertical"===this.layout?"top":"right";h.size()>0&&(this.bitmaps=wt({bitmaps:this.bitmaps,labelSelection:h,avoidMarks:[],validPositions:["middle"],offsets:[1],accessors:["key"],size:[xt(this.width,0),xt(this.height,0)],hideOnly:!1,removeOnly:!0}),h.classed("collision-removed",!1)),t.size()>0&&(this.bitmaps=gt({root:t,xScale:this.x,yScale:this.y,ordinalAccessor:this.groupAccessor,valueAccessor:this.valueAccessor,placement:this.dataLabel.placement,layout:this.layout,chartType:"stacked",normalized:this.normalized,avoidCollision:{runOccupancyBitmap:this.dataLabel.visible&&"auto"===this.dataLabel.placement,bitmaps:this.bitmaps,labelSelection:t,avoidMarks:[this.update],validPositions:i?["middle"]:e[this.layout][r].validPositions,offsets:i?[1]:e[this.layout][r].offsets,accessors:[this.groupAccessor,this.ordinalAccessor,"key"],size:[xt(this.width,0),xt(this.height,0)],boundsScope:i?void 0:r,hideOnly:this.dataLabel.visible&&this.dataLabel.collisionHideOnly,suppressMarkDraw:!0}}),t.classed("collision-added",!1))}}processLabelOpacity(t,i){const s=this.dataLabel.visible?1:0,h="vertical"===this.layout?"x":"y",e="vertical"===this.layout?"width":"height",a="vertical"===this.layout?"height":"width";t.attr("opacity",((t,r,o)=>{const c=+u(o[r]).attr("opacity"),l=u(o[r]).style("visibility"),n=this.normalized?t.getSum():1,d={};d[e]=this[h].bandwidth(),d[a]="vertical"===this.layout?this.y(t.stackEnd/n)-this.y(t.stackStart/n):this.x(t.stackStart/n)-this.x(t.stackEnd/n);const b="auto"===this.dataLabel.placement||this.dataLabel.collisionHideOnly||this.accessibility.showSmallLabels||y({text:lt(t,this.innerLabelAccessor,this.dataLabel.format,this.normalized),dimensions:d,fontSize:14})?J(t,s,this.hoverOpacity,this.hoverHighlight,this.clickHighlight,this.innerInteractionKeys)<1?i?Number.EPSILON:0:1:0;return(1===b&&"hidden"===l||c!==b)&&i&&(1===b?u(o[r]).classed("collision-added",!0).style("visibility",null):u(o[r]).classed("collision-removed",!0)),b}))}checkLabelColorAgainstBackground(){this.updateLabels.attr("fill",((t,i,s)=>this.textTreatmentHandler(t,i,s)))}bindInteractivity(){this.update.on("click",this.suppressEvents?null:(t,i,s)=>this.onClickHandler(t,s[i])).on("mouseover",this.suppressEvents?null:(t,i,s)=>this.onHoverHandler(t,s[i])).on("mouseout",this.suppressEvents?null:()=>this.onMouseOutHandler())}setRoundedCorners(){this.update.transition("shared_update").duration(this.duration).ease(p).attr("rx",this.roundedCorner).attr("ry",this.roundedCorner)}setSelectedClass(){this.update.classed("highlight",((t,i,s)=>{let h=J(t,!0,!1,"",this.clickHighlight,this.innerInteractionKeys);return h=!(!this.clickHighlight||!this.clickHighlight.length)&&h,_(s[i],h,this.accessibility.elementsAreInterface),h}))}updateCursor(){this.update.attr("cursor",this.suppressEvents?null:this.cursor),u(this.stackedBarChartEl).selectAll(".legend").style("cursor",!this.suppressEvents&&this.legend.interactive&&this.legend.visible?this.cursor:null)}enterDataLabels(){const t=this.dataLabel.visible?1:0;this.enterLabelWrappers.attr("class","stacked-bar-dataLabel-series entering"),this.enterLabels.attr("class","stacked-bar-dataLabel entering").style("pointer-events","none").classed("stacked-bar-dataLabel-"+this.layout,!0).attr("opacity",(i=>J(i,t,this.hoverOpacity,this.hoverHighlight,this.clickHighlight,this.innerInteractionKeys)<1?0:Number.EPSILON)).attr("fill",this.textTreatmentHandler),gt({root:this.enterLabels,xScale:this.x,yScale:this.y,ordinalAccessor:this.groupAccessor,valueAccessor:this.valueAccessor,placement:this.dataLabel.placement,layout:this.layout,chartType:"stacked",normalized:this.normalized})}updateDataLabels(){this.updateLabels.interrupt(),this.updateLabelWrappers.transition("update").duration(this.duration).ease(p).call(mt,(()=>{this.updateLabelWrappers.classed("entering",!1)}));const t=this.updateLabels.transition("opacity").ease(p).duration(((t,i,s)=>u(s[i]).classed("entering")?(u(s[i]).classed("entering",!1),this.duration):0));this.processLabelOpacity(t),t.call(mt,(()=>{this.updateLabels.classed("entering",!1)}))}exitDataLabels(){this.exitLabelWrappers.selectAll("text").attr("filter",null).transition("exit").ease(p).duration(this.duration/2).attr("opacity",0).call(mt,(()=>{this.exitLabelWrappers.remove()})),this.exitLabels.attr("filter",null).transition("exit").ease(p).duration(this.duration/2).attr("opacity",0).remove()}drawDataLabels(){let t=15;const i="auto"!==this.dataLabel.placement&&this.dataLabel.collisionHideOnly;this.updateLabels.classed("stacked-bar-dataLabel-horizontal",!1).classed("stacked-bar-dataLabel-vertical",!1).classed("stacked-bar-dataLabel-"+this.layout,!0).text(((i,s,h)=>{if(0===i[this.valueAccessor]&&!this.showZeroLabels)return"";if(0===s){const i=getComputedStyle(h[s]),e=parseFloat(i.fontSize);t=Math.max(e-1,1)}return lt(i,this.innerLabelAccessor,this.dataLabel.format,this.normalized)})).style("visibility",((t,i,s)=>"auto"===this.dataLabel.placement||this.dataLabel.collisionHideOnly?u(s[i]).style("visibility"):null)),this.updateLabelWrappers.transition("update").duration(this.duration).ease(p).call(mt,(()=>{this.updateLabelWrappers.classed("entering",!1)}));const s="vertical"===this.layout?"x":"y",h="vertical"===this.layout?"y":"x",e="vertical"===this.layout?"stackStart":"stackEnd",a=this.updateLabels.classed("textIsMoving",(t=>{if(!this.interpolating)return!1;const i=this.normalized?t.getSum():1;return this.interpolating[s](t[this.groupAccessor])!==this[s](t[this.groupAccessor])||this.interpolating[h](t[e]/i)!==this[h](t[e]/i)})).attr("data-translate-x",this.padding.left+this.margin.left).attr("data-translate-y",this.padding.top+this.margin.top).transition("update").ease(p).duration(this.duration),r={vertical:{top:{validPositions:["bottom"],offsets:[5]},middle:{validPositions:["middle"],offsets:[1]},bottom:{validPositions:["top"],offsets:[t/2]}},horizontal:{right:{validPositions:["left"],offsets:[8]},middle:{validPositions:["middle"],offsets:[1]},left:{validPositions:["right"],offsets:[20]}}},o=this.dataLabel&&this.dataLabel.collisionPlacement,c=o&&r[this.layout][o]?this.dataLabel.collisionPlacement:"vertical"===this.layout?"top":"right";this.bitmaps=gt({root:a,xScale:this.x,yScale:this.y,ordinalAccessor:this.groupAccessor,valueAccessor:this.valueAccessor,placement:this.dataLabel.placement,layout:this.layout,chartType:"stacked",normalized:this.normalized,avoidCollision:{runOccupancyBitmap:this.dataLabel.visible&&"auto"===this.dataLabel.placement,labelSelection:a,avoidMarks:[this.update],validPositions:i?["middle"]:r[this.layout][c].validPositions,offsets:i?[1]:r[this.layout][c].offsets,accessors:[this.groupAccessor,this.ordinalAccessor,"key"],size:[xt(this.width,0),xt(this.height,0)],boundsScope:i?void 0:c,hideOnly:this.dataLabel.visible&&this.dataLabel.collisionHideOnly}})}enterTotalDataLabels(){const t="vertical"===this.layout?"x":"y",i="vertical"===this.layout?"y":"x";this.enterTotalLabels.attr("class","bar-dataLabel-"+this.layout).attr("opacity",Number.EPSILON).attr("fill",ft.dark_text).attr(t,(i=>this[t](i.key)+this[t].bandwidth()/2)).attr(i,(t=>this[i](t.sumAboveZero)+4))}updateTotalDataLabels(){const t=this.showTotalValue&&!this.normalized?1:0;this.updateTotalLabels.transition("total_opacity").ease(p).duration(this.duration).attr("opacity",t)}exitTotalDataLabels(){this.exitTotalLabels.transition("exit").ease(p).duration(this.duration/2).attr("opacity",0).remove()}drawTotalDataLabels(){const t="vertical"===this.layout?"x":"y",i="vertical"===this.layout?"y":"x",s=this.showTotalValue&&!this.normalized?1:0;this.updateTotalLabels.text((t=>ot(t.sum,this.dataLabel.format))).attr("text-anchor","vertical"===this.layout?"middle":"start");const h=this.updateTotalLabels.classed("bar-dataLabel-horizontal",!1).classed("bar-dataLabel-vertical",!1).classed("bar-dataLabel-"+this.layout,!0).attr(`data-${t}`,(i=>this[t](i.key)+this[t].bandwidth()/2)).attr(`data-${i}`,(t=>this[i](t.sumAboveZero))).attr("data-use-dx",!0).attr("data-use-dy",!0).attr("data-translate-x",this.padding.left+this.margin.left).attr("data-translate-y",this.padding.top+this.margin.top).attr("dx","vertical"===this.layout?"0":"0.3em").attr("dy","vertical"===this.layout?"-0.3em":".3em").style("visibility",((t,i,s)=>"auto"===this.dataLabel.placement||this.dataLabel.collisionHideOnly?u(s[i]).style("visibility"):null)).transition("update").ease(p).duration(this.duration).attr("opacity",s);this.showTotalValue&&("auto"===this.dataLabel.placement||this.dataLabel.collisionHideOnly)?(this.bitmaps=wt({bitmaps:this.bitmaps,labelSelection:h,avoidMarks:[this.update],validPositions:["middle"],offsets:[1],accessors:[this.ordinalAccessor],size:[xt(this.width,0),xt(this.height,0)],hideOnly:!0}),h.attr(t,(i=>this[t](i.key)+this[t].bandwidth()/2)).attr(i,(t=>this[i](t.sumAboveZero)))):h.attr(t,(i=>this[t](i.key)+this[t].bandwidth()/2)).attr(i,(t=>this[i](t.sumAboveZero)))}drawReferenceLines(){const t=this.references.selectAll("g").data(this.referenceLines,(t=>t.label)),i=t.enter().append("g").attr("class",".stacked-bar-reference").attr("opacity",1),s=i.append("line");s.attr("class","stacked-bar-reference-line").attr("opacity",0);const h=i.append("text");h.attr("class","stacked-bar-reference-line-label").attr("opacity",0);const e=t.merge(i),a=e.selectAll(".stacked-bar-reference-line").data((t=>[t])).transition("merge").ease(p).duration(this.duration),r=e.selectAll(".stacked-bar-reference-line-label").data((t=>[t])).transition("merge").ease(p).duration(this.duration).text((t=>t.label));t.exit().transition("exit").ease(p).duration(this.duration).attr("opacity",0).remove(),"vertical"===this.layout?(i.attr("transform",(t=>"translate(0,"+this.y(t.value)+")")),e.transition("merge").ease(p).duration(this.duration).attr("transform",(t=>"translate(0,"+this.y(t.value)+")")),s.attr("x1",0).attr("y1",0).attr("y2",0).attr("x2",this.innerPaddedWidth),h.attr("text-anchor",(t=>"right"===(t.labelPlacementHorizontal||"right")?"start":"end")).attr("x",(t=>"right"===(t.labelPlacementHorizontal||"right")?this.innerPaddedWidth:0)).attr("y",0).attr("dx",(t=>"right"===(t.labelPlacementHorizontal||"right")?"0.1em":"-0.1em")).attr("dy","0.3em"),a.attr("x1",0).attr("y1",0).attr("y2",0).attr("x2",this.innerPaddedWidth),r.attr("text-anchor",(t=>"right"===(t.labelPlacementHorizontal||"right")?"start":"end")).attr("x",(t=>"right"===(t.labelPlacementHorizontal||"right")?this.innerPaddedWidth:0)).attr("y",0).attr("dx",(t=>"right"===(t.labelPlacementHorizontal||"right")?"0.1em":"-0.1em")).attr("dy","0.3em")):"horizontal"===this.layout&&(i.attr("transform",(t=>"translate("+this.x(t.value)+",0)")),e.transition("merge").ease(p).duration(this.duration).attr("transform",(t=>"translate("+this.x(t.value)+",0)")),s.attr("x1",0).attr("y1",this.innerPaddedHeight).attr("x2",0).attr("y2",0),a.attr("x1",0).attr("y1",this.innerPaddedHeight).attr("x2",0).attr("y2",0),h.attr("text-anchor","middle").attr("x",0).attr("y",(t=>"top"===(t.labelPlacementVertical||"top")?0:this.innerPaddedHeight)).attr("dx",0).attr("dy",(t=>"top"===(t.labelPlacementVertical||"top")?"-0.3em":"1em")),r.attr("text-anchor","middle").attr("x",0).attr("y",(t=>"top"===(t.labelPlacementVertical||"top")?0:this.innerPaddedHeight)).attr("dx",0).attr("dy",(t=>"top"===(t.labelPlacementVertical||"top")?"-0.3em":"1em"))),a.style("stroke",ft[this.referenceStyle.color]||this.referenceStyle.color).style("stroke-width",this.referenceStyle.strokeWidth).attr("stroke-dasharray",this.referenceStyle.dashed?this.referenceStyle.dashed:"").attr("opacity",this.referenceStyle.opacity),r.style("fill",ft[this.referenceStyle.color]||this.referenceStyle.color).attr("opacity",1)}drawAnnotations(){let t="horizontal"!==this.layout?this.x:this.y;const i="horizontal"!==this.layout?this.y:this.x;if(this.data[0][this.groupAccessor]instanceof Date){const i=o(this.data,(t=>t[this.groupAccessor])),s=c(this.data,(t=>t[this.groupAccessor])),h="horizontal"!==this.layout?[0,this.innerPaddedWidth]:[this.innerPaddedHeight,0];t=l().domain([s,i]).range(h)}Z({source:this.rootG.node(),data:this.annotations,xScale:"horizontal"!==this.layout?t:i,xAccessor:"horizontal"!==this.layout?this.groupAccessor:this.valueAccessor,yScale:"horizontal"!==this.layout?i:t,yAccessor:"horizontal"!==this.layout?this.valueAccessor:this.groupAccessor,width:this.width,height:this.height,padding:this.padding,margin:this.margin,bitmaps:this.bitmaps})}setAnnotationAccessibility(){R(this.stackedBarChartEl,this.annotations)}drawLegendElements(){et({root:this.legendG,uniqueID:this.chartID,width:this.innerPaddedWidth,height:this.margin.top+20,colorArr:this.colorArr,baseColorArr:this.preparedColors,hideStrokes:this.accessibility.hideStrokes,margin:this.margin,padding:this.padding,duration:this.duration,type:"bar",fontSize:16,data:this.legendData,labelKey:this.ordinalAccessor,label:this.legend.labels,hide:!this.legend.visible,interactionKeys:this.innerInteractionKeys,groupAccessor:this.ordinalAccessor,hoverHighlight:this.hoverHighlight,clickHighlight:this.clickHighlight,hoverStyle:this.hoverStyle,clickStyle:this.clickStyle,hoverOpacity:this.hoverOpacity})}bindLegendInteractivity(){u(this.stackedBarChartEl).selectAll(".legend").style("cursor",!this.suppressEvents&&this.legend.interactive&&this.legend.visible?this.cursor:null).on("click",!this.suppressEvents&&this.legend.interactive&&this.legend.visible?(t,i,s)=>this.onClickHandler(t,s[i]):null).on("mouseover",!this.suppressEvents&&this.legend.interactive&&this.legend.visible?(t,i,s)=>{this.hoverEvent.emit({data:t,target:s[i]})}:null).on("mouseout",!this.suppressEvents&&this.legend.interactive&&this.legend.visible?()=>this.onMouseOutHandler():null)}setTagLevels(){this.topLevel=L(this.highestHeadingLevel),this.bottomLevel=L(this.highestHeadingLevel,3)}setChartDescriptionWrapper(){T({rootEle:this.stackedBarChartEl,title:this.accessibility.title||this.mainTitle,chartTag:"stacked-bar-chart",uniqueID:this.chartID,highestHeadingLevel:this.highestHeadingLevel,redraw:this.shouldRedrawWrapper,disableKeyNav:this.suppressEvents&&!1===this.accessibility.elementsAreInterface&&this.accessibility.keyboardNavConfig&&this.accessibility.keyboardNavConfig.disabled}),this.shouldRedrawWrapper=!1}setParentSVGAccessibility(){I({node:this.svg.node(),chartTag:"stacked-bar-chart",title:this.accessibility.title||this.mainTitle,description:this.subTitle,uniqueID:this.chartID,geomType:"bar",includeKeyNames:this.accessibility.includeDataKeyNames,dataKeys:yt(this,U,"stacked-bar-chart"),dataKeyNames:this.dataKeyNames,groupAccessor:this.groupAccessor,groupName:"stack",groupKeys:!!this.showTotalValue&&["sumMessage"],disableKeyNav:this.suppressEvents&&!1===this.accessibility.elementsAreInterface&&this.accessibility.keyboardNavConfig&&this.accessibility.keyboardNavConfig.disabled})}setGeometryAccessibilityAttributes(){this.update.each(((t,i,s)=>{D(s[i])}))}setGeometryAriaLabels(){const t=yt(this,U,"stacked-bar-chart");this.update.each(((i,s,h)=>{z({node:h[s],geomType:"bar",includeKeyNames:this.accessibility.includeDataKeyNames,dataKeys:t,dataKeyNames:this.dataKeyNames,groupKeys:!!this.showTotalValue&&["sumMessage"],groupName:"stack",uniqueID:this.chartID,disableKeyNav:this.suppressEvents&&!1===this.accessibility.elementsAreInterface&&this.accessibility.keyboardNavConfig&&this.accessibility.keyboardNavConfig.disabled}),C({node:h[s],uniqueID:this.chartID})}))}setGroupAccessibilityID(){this.updateBarWrappers.each(((t,i,s)=>{C({node:s[i],uniqueID:this.chartID})}))}setChartAccessibilityTitle(){E(this.stackedBarChartEl,this.accessibility.title||this.mainTitle)}setChartAccessibilitySubtitle(){P(this.stackedBarChartEl,this.subTitle)}setChartAccessibilityLongDescription(){N(this.stackedBarChartEl,this.accessibility.longDescription)}setChartAccessibilityExecutiveSummary(){j(this.stackedBarChartEl,this.accessibility.executiveSummary)}setChartAccessibilityPurpose(){K(this.stackedBarChartEl,this.accessibility.purpose)}setChartAccessibilityContext(){H(this.stackedBarChartEl,this.accessibility.contextExplanation)}setChartAccessibilityStatisticalNotes(){G(this.stackedBarChartEl,this.accessibility.statisticalNotes)}setChartCountAccessibility(){$({rootEle:this.stackedBarChartEl,parentGNode:this.barG.node(),chartTag:"stacked-bar-chart",geomType:"bar",groupName:"stack"})}setChartAccessibilityStructureNotes(){q(this.stackedBarChartEl,this.accessibility.structureNotes)}onChangeHandler(){this.accessibility&&"function"==typeof this.accessibility.onChangeFunc&&this.accessibility.onChangeFunc({updated:this.updated,added:this.enterSize,removed:this.exitSize}),this.updated=!1,this.enterSize=0,this.exitSize=0}onClickHandler(t,i){this.clickEvent.emit({data:t,target:i})}onHoverHandler(t,i){vt(this.chartID,!0),this.hoverEvent.emit({data:t,target:i}),this.showTooltip&&t&&this.eventsTooltip({data:t,evt:b,isToShow:!0})}onMouseOutHandler(){vt(this.chartID,!1),this.mouseOutEvent.emit(),this.showTooltip&&this.eventsTooltip({isToShow:!1})}setTooltipInitialStyle(){pt(this.tooltipG)}eventsTooltip({data:t,evt:i,isToShow:s}){rt({root:this.tooltipG,data:t,event:i,isToShow:s,tooltipLabel:this.tooltipLabel,dataKeyNames:this.dataKeyNames,xAxis:this.xAxis,yAxis:this.yAxis,dataLabel:this.dataLabel,layout:this.layout,ordinalAccessor:this.groupAccessor,groupAccessor:this.ordinalAccessor,valueAccessor:this.valueAccessor,normalized:this.normalized,chartType:"stacked"})}render(){return this.drawStartEvent.emit({chartID:this.chartID}),this.init(),this.shouldSetTagLevels&&(this.setTagLevels(),this.shouldSetTagLevels=!1),this.shouldCheckValueAxis&&("horizontal"===this.layout?(this.shouldUpdateXAxis=!0,this.shouldSetXAxisAccessibility=!0,this.shouldUpdateXGrid=!0):"vertical"===this.layout&&(this.shouldUpdateYAxis=!0,this.shouldSetYAxisAccessibility=!0,this.shouldUpdateYGrid=!0),this.shouldCheckValueAxis=!1),this.shouldCheckLabelAxis&&("vertical"===this.layout?(this.shouldUpdateXAxis=!0,this.shouldSetXAxisAccessibility=!0):"horizontal"===this.layout&&(this.shouldUpdateYAxis=!0,this.shouldSetYAxisAccessibility=!0),this.shouldCheckLabelAxis=!1),this.shouldUpdateData&&(this.prepareData(),this.shouldUpdateData=!1),this.shouldUpdateLegendData&&(this.prepareLegendData(),this.shouldUpdateLegendData=!1),this.shouldSetDimensions&&(this.setDimensions(),this.shouldSetDimensions=!1),this.shouldUpdateScales&&(this.prepareScales(),this.shouldUpdateScales=!1),this.shouldValidateClickHighlight&&(this.validateClickHighlight(),this.shouldValidateClickHighlight=!1),this.shouldValidateInteractionKeys&&(this.validateInteractionKeys(),this.shouldValidateInteractionKeys=!1),this.shouldValidateDataLabelAccessor&&(this.validateDataLabelAccessor(),this.shouldValidateDataLabelAccessor=!1),this.shouldValidateAxes&&(this.validateAxes(),this.shouldValidateAxes=!1),this.shouldUpdateTableData&&(this.setTableData(),this.shouldUpdateTableData=!1),this.shouldValidate&&(this.shouldValidateAccessibilityProps(),this.shouldValidate=!1),this.shouldSetColors&&(this.setColors(),this.shouldSetColors=!1),this.shouldValidateLabelPlacement&&(this.validateLabelPlacement(),this.shouldValidateLabelPlacement=!1),s("div",{class:`o-layout is--${this.layout} light`},s("div",{class:"o-layout--chart"},s(this.topLevel,{class:"stacked-bar-main-title vcl-main-title"},this.mainTitle),s(this.bottomLevel,{class:"visa-ui-text--instructions stacked-bar-sub-title vcl-sub-title"},this.subTitle),s("div",{class:"stacked-bar-legend vcl-legend",style:{display:this.legend.visible?"block":"none"}}),s("keyboard-instructions",{uniqueID:this.chartID,geomType:"bar",groupName:"stack",chartTag:"stacked-bar-chart",width:this.width-(this.margin&&this.margin.right||0),isInteractive:this.accessibility.elementsAreInterface,hasCousinNavigation:!0,disabled:this.suppressEvents&&!1===this.accessibility.elementsAreInterface&&this.accessibility.keyboardNavConfig&&this.accessibility.keyboardNavConfig.disabled}),s("div",{class:"visa-viz-d3-stacked-bar-container"}),s("div",{class:"stacked-bar-tooltip vcl-tooltip",style:{display:this.showTooltip?"block":"none"}}),s("data-table",{uniqueID:this.chartID,isCompact:!0,tableColumns:this.tableColumns,dataKeyNames:this.dataKeyNames,data:this.tableData,padding:this.padding,margin:this.margin,hideDataTable:this.accessibility.hideDataTableButton,unitTest:this.unitTest})))}init(){const t=Object.keys(g);let i=0;const s={mainTitle:{exception:""},subTitle:{exception:""},showTooltip:{exception:!1},wrapLabel:{exception:!1},showTotalValue:{exception:!1},barIntervalRatio:{exception:0},hoverOpacity:{exception:0}};for(i=0;i<t.length;i++){const h=!!s[t[i]]&&this[t[i]]===s[t[i]].exception;this[t[i]]=this[t[i]]||h?this[t[i]]:g[t[i]]}}get stackedBarChartEl(){return h(this)}static get watchers(){return{data:["dataWatcher"],uniqueID:["idWatcher"],highestHeadingLevel:["headingWatcher"],mainTitle:["titleWatcher"],subTitle:["subtitleWatcher"],height:["dimensionWatcher"],width:["dimensionWatcher"],padding:["dimensionWatcher"],margin:["dimensionWatcher"],layout:["layoutWatcher"],ordinalAccessor:["ordinalAccessorWatcher"],valueAccessor:["valueAccessorWatcher"],groupAccessor:["groupAccessorWatcher"],sortOrder:["sortWatcher"],xAxis:["xAxisWatcher"],yAxis:["yAxisWatcher"],wrapLabel:["wrapLabelWatcher"],normalized:["normalizedWatcher"],colorPalette:["paletteWatcher"],colors:["colorsWatcher"],hoverStyle:["hoverStyleWatcher"],clickStyle:["clickStyleWatcher"],referenceLines:["referenceWatcher"],referenceStyle:["referenceWatcher"],cursor:["cursorWatcher"],roundedCorner:["cornerWatcher"],barIntervalRatio:["intervalRatioWatcher"],hoverOpacity:["hoverOpacityWatcher"],dataLabel:["labelWatcher"],showTotalValue:["showTotalValueWatcher"],showTooltip:["showTooltipWatcher"],tooltipLabel:["tooltipLabelWatcher"],accessibility:["accessibilityWatcher"],showZeroLabels:["showZeroLabelsWatcher"],legend:["legendWatcher"],annotations:["annotationsWatcher"],maxValueOverride:["valueOverrideWatcher"],minValueOverride:["valueOverrideWatcher"],interactionKeys:["interactionWatcher"],dataKeyNames:["dataKeyNamesWatcher"],hoverHighlight:["hoverWatcher"],clickHighlight:["clickWatcher"],suppressEvents:["suppressWatcher"],unitTest:["unitTestWatcher"]}}};window.VisaChartsLibOSSLicenses=ut(),At.style=".o-layout{width:100%;display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap}.o-layout--chart{width:100%}.is--vertical .o-layout--chart{width:90%}stacked-bar-chart{cursor:default}stacked-bar-chart .annotations{pointer-events:none}stacked-bar-chart .annotations .handle{pointer-events:all}stacked-bar-chart .screen-reader-info{position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden}stacked-bar-chart .data-table-link{color:#767676;text-decoration:none;font-size:12px;margin-left:5%}stacked-bar-chart .hidden{display:none}stacked-bar-chart #visa-viz-d3-stacked-bar-container{clear:both}stacked-bar-chart .stacked-bar-legend{font-size:1em;display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;-ms-flex-pack:start;justify-content:flex-start;-ms-flex-wrap:wrap;flex-wrap:wrap}stacked-bar-chart .stacked-bar-legend .legend{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;-ms-flex-pack:start;justify-content:flex-start;margin-right:10px}stacked-bar-chart .stacked-bar-legend .key-dot{margin:3px 8px}stacked-bar-chart .light .grid line{stroke:#767676;stroke-opacity:1;stroke-width:0.8;stroke-dasharray:4, 4}stacked-bar-chart .light .grid path{stroke-width:0}stacked-bar-chart .light .axis{font-size:12px}stacked-bar-chart .light .axis .tick text{fill:#767676}stacked-bar-chart .light .axis .tick line{stroke:#767676}stacked-bar-chart .light .axis-label{text-anchor:middle;font:1rem sans-serif}stacked-bar-chart .light .y.axis path{stroke:#767676;opacity:0}stacked-bar-chart .light .x.axis path{stroke:#767676}stacked-bar-chart .light .o-layout--chart .bar-dataLabel-vertical{font-size:1rem;fill:#767676;font-weight:550}stacked-bar-chart .light .o-layout--chart .bar-dataLabel-horizontal{font-size:1rem;fill:#767676;font-weight:550}stacked-bar-chart .dark .grid line{stroke:lightgrey;stroke-opacity:0.7;shape-rendering:crispEdges}stacked-bar-chart .dark .grid path{stroke-width:0}stacked-bar-chart .dark .axis{font-size:12px}stacked-bar-chart .dark .axis .tick line{stroke:lightgrey}stacked-bar-chart .dark .axis .tick text{fill:grey}stacked-bar-chart .dark .axis path{stroke:black}stacked-bar-chart .dark .axis-label{text-anchor:middle;font:1rem sans-serif}stacked-bar-chart .dark .o-layout--chart svg{background:black}stacked-bar-chart .dark .o-layout--chart svg .bar-dataLabel-vertical{fill:#767676;text-anchor:middle}stacked-bar-chart .dark .o-layout--chart svg .bar-dataLabel-horizontal{fill:#767676;text-anchor:start}";export{At as stacked_bar_chart}